# 가비지 컬렉션(Gargbage Collection)

객체가 생성되었을 때 자동으로 메모리를 할당하고 필요없을 때 자동으로 해제

## 메모리 생존 주기

1. 필요할 때 메모리 할당( Allocation )
2. 메모리 사용( Read or Write)
3. 필요없어지면 해제, 메모리 비우기 ( Release )

이 때, "할당된 메모리가 더 이상 필요없을 때"를 자동으로 알아내기 위해 `가비지 콜렉션`이라는 자동 메모리 관리 방법을 사용

## 가비지 컬렉션 기준

`도달 가능성(reachability)` 사용

: 어떻게든 접근하거나 사용할 수 있는 값으로, 메모리에서 삭제되지 않음

1. **`루트(root)`** : 도달 가능한 값

    - 현재 함수의 지역 변수와 매개변수

    - 중첩합수의 체인에 있는 함수에서 사용되는 변수와 매개변수

    - 전역 변수

    - 기타

2. 루트가 참조하는 값이나 체이닝으로 루트에서 참조할 수 있는 값

## 가비지 컬렉션의 동작

### 참조(Reference)

가비지 컬렉션 알고리즘의 핵심개념

A라는 메모리를 통해 B라는 메모리에 접근할 수 있다 => `"B는 A에 참조된다"

### `참조-세기(Reference-counting)` 알고리즘

더 이상 필요없는 오브젝트 => "어떤 다른 오브젝트도 참조하지 않는 오브젝트" 즉, `가비지`

이를 참조하는 다른 오브젝트가 하나도 없는 경우 수집 가능

but, 두 객체가 서로 참조하는 속성으로 순환구조를 생성하는 `순환참조`에서는 **한계** 발생

함수 호출이 완료되어 두 객체가 불필요해지면 할당된 메모리를 회수해야 하지만 서로를 참조하고 있는 경우 가비지 컬렉션의 대상으로 표시하지 않음

### `Mark-and-Sweep` 알고리즘

"더 이상 필요없는 오브젝트" => "`닿을 수 없는` 오브젝트"로 정의

- 루트(root) 정보를 수집하고 이를 **`mark(기억)`**

- 루트가 참조하고 있는 모든 객체 방문하고 이를 mark, 그 객체들이 참조하는 객체도 mark.

- root에서 도달가능한 모든 객체를 방문할 때까지 위 과정 반복

- mark되지 않은 모든 객체를 메모리에서 `삭제(sweep)`

순환참조가 발생해도 root와의 참조가 없다면 실제로는 더이상 사용되지 않을 것이라는 판단이 가능

### 추가 reference

- 자바스크립트의 메모리 관리와 가비지 컬렉션(Garbage Collection)

<https://webisfree.com/2021-03-22/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EC%9D%98-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EA%B4%80%EB%A6%AC%EC%99%80-%EA%B0%80%EB%B9%84%EC%A7%80-%EC%BB%AC%EB%A0%89%EC%85%98(garbage-collection)>
